# 性能优化的指标和工具

## TTI (Time to Interactive) 和 TBT（Total Blocking Time）

### TTI (Time to Interactive) 
可交互时间 (TTI) 是测量加载响应度的重要实验室指标。该指标有助于识别看起来具备交互性但实际上并非如此的页面情况。迅捷的 TTI 有助于确保页面的有效性。
#### 概念
TTI 指标测量页面从开始加载到主要子资源完成渲染，并能够快速、可靠地响应用户输入所需的时间。

<font color="red">
很多时候，开发者为了追求更快的渲染速度而对页面进行了优化，但有时，这会以牺牲 TTI 为代价。

服务器端渲染 (SSR) 等技术可能会导致页面看似具备交互性（即，链接和按钮在屏幕上可见），但实际上并不能进行交互，因为主线程被阻塞或是因为控制这些元素的 JavaScript 代码尚未完成加载。

当用户尝试与看似具备交互性但实际上并非如此的页面进行交互时，他们可能会有如下两种反应：
* 在最好的情况下，他们会因为页面响应缓慢而感到恼火。
* 在最坏的情况下，他们会认为页面已损坏，因此很可能直接离开。他们甚至可能对您的品牌价值丧失信心或信任。

为了避免这个问题，请尽一切努力将 FCP 和 TTI 之间的差值降至最低。如果两者在某些情况下确实存在明显差异，请通过视觉指示器清楚表明页面上的组件还无法进行交互。
</font>

#### TTI计算方法
1. 先进行FCP
2. 沿时间轴正向搜索时长至少为 5 秒的安静窗口，其中，安静窗口的定义为：没有长任务且不超过两个正在处理的网络 GET 请求。
3. 沿时间轴反向搜索安静窗口之前的最后一个长任务，如果没有找到长任务，则在 FCP 步骤停止执行。
4. TTI 是安静窗口之前最后一个长任务的结束时间（如果没有找到长任务，则与 FCP 值相同）。

下图展示了TTI的计算
<img src="./images/TTI.svg" />


#### 测量
* lighthouse


#### 影响TTI的因素

1. 导致FCP延迟的所以因素
2. JS执行时间
3. 请求的数目

### TBT（Total Blocking Time）

#### 概念
总阻塞时间 (TBT) 指标测量First Contentful Paint 首次内容绘制 (FCP)与Time to Interactive 可交互时间 (TTI)之间的总时间。
#### 总阻塞时长计算方法
|            | 任务持续时间 | 任务阻塞时间 |
| ---------- | ------------ | ------------ |
| 任务一     | 250 毫秒     | 200 毫秒     |
| 任务二     | 90 毫秒      | 40 毫秒      |
| 任务三     | 35 毫秒      | 0 毫秒       |
| 任务四     | 30 毫秒      | 0 毫秒       |
| 任务五     | 155 毫秒     | 105 毫秒     |
| 总阻塞时长 |              | 345 毫秒     |
#### 测量
* lighthouse
#### 影响的因素
1. JS执行时间
2. 主线程工作
3. 请求的数目

