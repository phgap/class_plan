# Chrome浏览器插件开发

### 基础开发

* #### extension结构
  * **[The manifest](https://developer.chrome.com/docs/extensions/mv3/manifest/)**

  * **[The service worker](https://developer.chrome.com/docs/extensions/mv3/service_workers/)**

  * **[Content scripts](https://developer.chrome.com/docs/extensions/mv3/content_scripts/)**
 
  * **The popup and other pages**
    * popup
    * options
    * other page

* #### 第一次
  * **Hello Chrome extension**

* #### 基础练习
  * **[UI开发](https://developer.chrome.com/docs/extensions/mv3/user_interface)**
    *   **action**
        注册自定义action动作
        ```json
        {
          "name": "My Awesome action MV3 Extension",
          ...
          "action": {
            ...
          }
          ...
        }
        ```
        * 指定图标
        ```json
        {
          "name": "My Awesome action MV3 Extension",
          ...
          "action": {
            "default_icon": {              
              "16": "images/icon16.png",   // 浏览器工具栏显示
              "32": "images/icon32.png",   // windows操作系统使用
              "48": "images/icon48.png",   // 插件管理页面
              "128": "images/icon128.png"  // Chrome Web Store使用
            },
          }
          ...
        }
        ```
        * 指定其他图标
        ```json
        {
          "name": "My Awesome action MV3 Extension",
          ...
          "action": {
            "default_icon": {
              // 工具栏优先显示改配置项指定的路径，
              // 但无法在此处指定该插件其他的图标              
              "16": "images/icon16.png",   
            },
          }，
          "icon": {
            "16": "images/icon16.png",   // 浏览器工具栏显示
            "32": "images/icon32.png",   // windows操作系统使用
            "48": "images/icon48.png",   // 插件管理页面
            "128": "images/icon128.png"  // Chrome Web Store使用
          }
          ...
        }
        ```
        * 指定提示信息
        ```json
        {
          "name": "Action Extension",
          ...
          "action": {
            "default_title": "插件功能说明"
          },
          ...
        }
        ```
        * 指定popup的页面
        ```json
        {
          "name": "Action Extension",
          ...
          "action": {
            "default_popup": "popup.html"
          },
          ...
        }
        ```
        * badge
        ```js
        chrome.action.setBadgeText()  // 设置文字，最多4个
        chrome.action.setBadgeBackgroundColor() // 设置背景色
        ```
        * 监听点击

        
    * **Omnibox**
      > The omnibox API allows you to register a keyword with Google Chrome's address bar, When the user enters your extension's keyword, the user starts interacting solely with your extension. Each keystroke is sent to your extension, and you can provide suggestions in response.
    * **Context menu**
        在页面的右键菜单中添加一个菜单项，并相应点击事件
    * **Commands**
      > 可以定义快捷键，监听并执行对应的动作。
    * **Override pages**
      > 顾名思义，覆盖Chrome提供的页面，例如：书签管理页，历史记录，新选项卡
    * **Notifications**
      > 在扩展中可以发送一个通知，以浏览器的通知栏方式显示

  * **[Content scripts](https://developer.chrome.com/docs/extensions/mv3/content_scripts/)**
      > Content scripts are files that run in the context of web pages. By using the standard Document Object Model (DOM), they are able to read details of the web pages the browser visits, make changes to them, and pass information to their parent extension.
    * 能力
      * i18n
      * storage
      * runtime
        * connect
        * getManifest
        * getURL
        * id
        * onConnect
        * onMessage
        * sendMessage
  * **[The service worker](https://developer.chrome.com/docs/extensions/mv3/service_workers/)**
  
  概念：
    > Extensions are event-based programs used to modify or enhance the Chrome browsing experience. Events are browser triggers, such as navigating to a new page, removing a bookmark, or closing a tab. Extensions monitor these events using scripts in their background service worker, which then react with specified instructions.
  
  加载时机：
    > A background service worker is loaded when it is needed, and unloaded when it goes idle. Some examples include:
    > * The extension is first installed or updated to a new version.
    > * The background page was listening for an event, and the event is dispatched.
    > * A content script or other extension sends a message.
    > * ~~Another view in the extension, such as a popup, calls runtime.getBackgroundPage~~ (已经取不到值，参照[stackoverflow](https://stackoverflow.com/questions/74224782/background-page-runs-but-popup-says-you-do-not-have-a-background-page-when-u))
  
  使用方法：
    1. 注册
    2. 在js文件中添加事件监听
       1. chrome.runtime.onInstalled // 组件安装时触发
       2. chrome.action.onClicked
       3. chrome.declarativeContent.onPageChanged.removeRules
       4. chrome.alarms.onAlarm.addListener
       5. chrome.audio.onDeviceListChanged
       6. chrome.audio.onLevelChanged
       7. chrome.audio.onMuteChanged
* #### 简单但综合的例子
https://itnext.io/all-youll-ever-need-to-know-about-chrome-extensions-ceede9c28836

*   badge
            > Badges display a colored banner on top of the action icon. They can only be used when the "action" is declared in the manifest.
            Use badges to indicate the state of the extension. The Drink Water sample extension displays a badge with "ON" to show the user they have successfully set an alarm and displays nothing when the extension is idle. Badges can contain up to 4 characters.

            > 设置文字：chrome.action.setBadgeText() 最多四个字符
            > 设置banner颜色：chrome.action.setBadgeBackgroundColor()

        * Click Event
          > 用户点击图标时，会触发。但是如果action指定了popup，该事件则不会触发

          **TODO: 案例**
          * 有popup
          * 无popup


  
* #### 发布
  > https://developer.chrome.com/docs/webstore/publish/

* #### 官方文档
  * [Chrome APIs](https://developer.chrome.com/docs/extensions/reference/)
  * [Extension development overview](https://developer.chrome.com/docs/extensions/mv3/devguide/)